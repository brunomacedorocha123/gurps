<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ficha do Personagem - Visão do Mestre</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="estilo-ficha-gm.css">
</head>
<body>
  <!-- LOADING OVERLAY -->
  <div id="loadingOverlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <p>Carregando dados do personagem...</p>
    </div>
  </div>

  <!-- CABEÇALHO DO MESTRE -->
  <header class="cabecalho-mestre">
    <div class="cabecalho-conteudo">
      <!-- LOCALIZAÇÃO -->
      <div class="localizacao">
        <a href="#" id="btnVoltarCampanha" class="link-localizacao">
          <i class="fas fa-arrow-left"></i> Voltar para Campanha
        </a>
        <span class="separador">/</span>
        <span class="atual">Ficha do Personagem</span>
      </div>
      
      <!-- CONTROLES DO MESTRE -->
      <div class="controles-mestre">
        <div class="info-sessao">
          <span class="nome-campanha" id="nomeCampanha">Campanha</span>
          <span class="nome-jogador" id="nomeJogador">Jogador</span>
        </div>
        
        <div class="acoes-mestre">
          <!-- CONTROLE DE VISUALIZAÇÃO (REMOVEMOS O INSTANTÂNEO) -->
          <div class="alternar-visualizacao">
            <button class="botao-visualizacao ativo" data-visao="ao-vivo">
              <i class="fas fa-sync"></i> Ao Vivo
            </button>
            <button class="botao-visualizacao" data-visao="campanha">
              <i class="fas fa-book"></i> Campanha
            </button>
          </div>
          
          <!-- CONTROLES DE GERENCIAMENTO -->
          <div class="gerenciamento-rapido">
            <button class="botao-acao" id="btnCongelar">
              <i class="fas fa-snowflake"></i> Congelar PV
            </button>
            <button class="botao-acao" id="btnSincronizar">
              <i class="fas fa-redo"></i> Sincronizar
            </button>
            <button class="botao-acao perigo" id="btnRemover">
              <i class="fas fa-user-minus"></i> Remover
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- NOME E INFORMAÇÕES PRINCIPAIS -->
  <section class="identificacao-personagem">
    <div class="foto-personagem">
      <div class="container-foto" id="containerFoto">
        <img id="fotoPersonagem" src="" alt="Foto" style="display: none;">
        <div class="placeholder-foto" id="placeholderFoto">
          <i class="fas fa-user-circle"></i>
        </div>
      </div>
    </div>
    
    <div class="dados-principais">
      <h1 id="nomePersonagem">Carregando...</h1>
      <div class="tags-identificacao">
        <span class="tag" id="racaPersonagem">Raça</span>
        <span class="tag" id="classePersonagem">Classe</span>
        <span class="tag" id="nivelPersonagem">Nível 1</span>
        <span class="tag" id="pontosPersonagem">0 pontos</span>
      </div>
      <p class="descricao-personagem" id="descricaoPersonagem">
        Descrição do personagem carregando...
      </p>
    </div>
    
    <div class="status-rapido">
      <div class="card-status">
        <div class="cabecalho-status">
          <i class="fas fa-heartbeat"></i>
          <h4>Pontos de Vida</h4>
          <span class="status-indicator" id="pvStatus"></span>
        </div>
        <div class="conteudo-status">
          <div class="valor-status" id="pvAtualGM">10</div>
          <div class="maximo-status">/ <span id="pvMaximoGM">10</span></div>
        </div>
        <div class="controles-rapidos">
          <button class="btn-controle" data-acao="dano" data-valor="1">-1</button>
          <button class="btn-controle" data-acao="dano" data-valor="5">-5</button>
          <button class="btn-controle cura" data-acao="cura" data-valor="1">+1</button>
          <button class="btn-controle cura" data-acao="cura" data-valor="5">+5</button>
        </div>
        <input type="number" id="inputPvCustom" class="input-custom" placeholder="Valor personalizado" min="1" max="999">
        <button class="btn-controle-full" id="btnAplicarPvCustom">Aplicar</button>
      </div>
      
      <div class="card-status">
        <div class="cabecalho-status">
          <i class="fas fa-bolt"></i>
          <h4>Pontos de Fadiga</h4>
        </div>
        <div class="conteudo-status">
          <div class="valor-status" id="pfAtualGM">10</div>
          <div class="maximo-status">/ <span id="pfMaximoGM">10</span></div>
        </div>
        <div class="controles-rapidos">
          <button class="btn-controle" data-acao="fadiga" data-valor="1">-1</button>
          <button class="btn-controle cura" data-acao="recuperar" data-valor="1">+1</button>
        </div>
      </div>
      
      <div class="card-status">
        <div class="cabecalho-status">
          <i class="fas fa-coins"></i>
          <h4>Dinheiro</h4>
        </div>
        <div class="conteudo-status">
          <div class="valor-status dinheiro" id="dinheiroGM">$0</div>
        </div>
        <div class="controles-rapidos">
          <button class="btn-controle" data-acao="dinheiro" data-valor="10">+$10</button>
          <button class="btn-controle" data-acao="dinheiro" data-valor="50">+$50</button>
        </div>
      </div>
    </div>
  </section>

  <!-- ABA DE NAVEGAÇÃO (APENAS 2 ABAS) -->
  <nav class="navegacao-fichas">
    <div class="container-tabs">
      <button class="tab ativo" data-tab="resumo">
        <i class="fas fa-eye"></i>
        <span>Visão Geral</span>
      </button>
      <button class="tab" data-tab="anotacoes">
        <i class="fas fa-edit"></i>
        <span>Anotações</span>
      </button>
    </div>
  </nav>

  <!-- CONTEÚDO DAS ABAS -->
  <main class="conteudo-ficha">
    
    <!-- ABA: VISÃO GERAL (RESUMO) -->
    <div id="aba-resumo" class="conteudo-aba ativo">
      <div class="resumo-container">
        
        <!-- COLUNA 1: ATRIBUTOS E MOVIMENTO -->
        <div class="coluna-resumo">
          <!-- CARD DE ATRIBUTOS PRINCIPAIS -->
          <div class="card-resumo">
            <div class="cabecalho-card">
              <h3><i class="fas fa-chart-bar"></i> Atributos Principais</h3>
            </div>
            <div class="grade-atributos">
              <div class="item-atributo">
                <span class="rotulo">FOR</span>
                <span class="valor" id="gmST">10</span>
                <span class="modificador" id="gmSTMod">[0]</span>
              </div>
              <div class="item-atributo">
                <span class="rotulo">DES</span>
                <span class="valor" id="gmDX">10</span>
                <span class="modificador" id="gmDXMod">[0]</span>
              </div>
              <div class="item-atributo">
                <span class="rotulo">INT</span>
                <span class="valor" id="gmIQ">10</span>
                <span class="modificador" id="gmIQMod">[0]</span>
              </div>
              <div class="item-atributo">
                <span class="rotulo">SAÚ</span>
                <span class="valor" id="gmHT">10</span>
                <span class="modificador" id="gmHTMod">[0]</span>
              </div>
              <div class="item-atributo">
                <span class="rotulo">VONT</span>
                <span class="valor" id="gmVontade">10</span>
              </div>
              <div class="item-atributo">
                <span class="rotulo">PER</span>
                <span class="valor" id="gmPercepcao">10</span>
              </div>
            </div>
          </div>

          <!-- CARD DE MOVIMENTO -->
          <div class="card-resumo">
            <div class="cabecalho-card">
              <h3><i class="fas fa-running"></i> Movimento</h3>
            </div>
            <div class="info-grid">
              <div class="info-item">
                <span class="rotulo">Deslocamento</span>
                <span class="valor" id="gmDeslocamento">5</span>
              </div>
              <div class="info-item">
                <span class="rotulo">Bônus</span>
                <span class="valor" id="gmBonusMovimento">0</span>
              </div>
              <div class="info-item">
                <span class="rotulo">Carga Atual</span>
                <span class="valor" id="gmCargaAtual">0</span>
              </div>
              <div class="info-item">
                <span class="rotulo">Carga Máx.</span>
                <span class="valor" id="gmCargaMaxima">0</span>
              </div>
            </div>
          </div>

          <!-- CARD DE STATUS DE COMBATE -->
          <div class="card-resumo">
            <div class="cabecalho-card">
              <h3><i class="fas fa-shield-alt"></i> Status de Combate</h3>
            </div>
            <div class="status-combate-gm">
              <div class="item-status">
                <span class="rotulo">Esquiva:</span>
                <span class="valor" id="gmEsquiva">10</span>
              </div>
              <div class="item-status">
                <span class="rotulo">Bloqueio:</span>
                <span class="valor" id="gmBloqueio">-</span>
              </div>
              <div class="item-status">
                <span class="rotulo">Aparar:</span>
                <span class="valor" id="gmAparar">-</span>
              </div>
              <div class="item-status">
                <span class="rotulo">Dano (Golpe):</span>
                <span class="valor" id="gmDanoGolpe">1d-2</span>
              </div>
              <div class="item-status">
                <span class="rotulo">Dano (Arrem.):</span>
                <span class="valor" id="gmDanoArremesso">1d</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- COLUNA 2: PERÍCIAS E MAGIAS -->
        <div class="coluna-resumo">
          <!-- CARD DE PERÍCIAS PRINCIPAIS -->
          <div class="card-resumo">
            <div class="cabecalho-card">
              <h3><i class="fas fa-graduation-cap"></i> Perícias</h3>
              <span class="badge" id="totalPericias">0</span>
            </div>
            <div class="lista-pericias-gm" id="listaPericiasGM">
              <div class="pericia-item">
                <span class="nome-pericia">Carregando perícias...</span>
                <span class="nivel-pericia">-</span>
              </div>
            </div>
          </div>

          <!-- CARD DE MAGIAS -->
          <div class="card-resumo">
            <div class="cabecalho-card">
              <h3><i class="fas fa-hat-wizard"></i> Magias</h3>
              <span class="badge" id="totalMagias">0</span>
            </div>
            <div class="lista-magias-gm" id="listaMagiasGM">
              <div class="magia-item">
                <span class="nome-magia">Carregando magias...</span>
                <span class="nivel-magia">-</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- COLUNA 3: VANTAGENS, DESVANTAGENS E EQUIPAMENTO -->
        <div class="coluna-resumo">
          <!-- CARD DE VANTAGENS -->
          <div class="card-resumo">
            <div class="cabecalho-card">
              <h3><i class="fas fa-star"></i> Vantagens</h3>
              <span class="badge" id="totalVantagensGM">0</span>
            </div>
            <div class="lista-vantagens-gm" id="listaVantagensGM">
              <div class="vantagem-item">
                <span class="nome-vantagem">Carregando vantagens...</span>
                <span class="custo-vantagem">-</span>
              </div>
            </div>
          </div>

          <!-- CARD DE DESVANTAGENS -->
          <div class="card-resumo">
            <div class="cabecalho-card">
              <h3><i class="fas fa-exclamation-triangle"></i> Desvantagens</h3>
              <span class="badge" id="totalDesvantagensGM">0</span>
            </div>
            <div class="lista-desvantagens-gm" id="listaDesvantagensGM">
              <div class="desvantagem-item">
                <span class="nome-desvantagem">Carregando desvantagens...</span>
                <span class="custo-desvantagem">-</span>
              </div>
            </div>
          </div>

          <!-- CARD DE EQUIPAMENTO RÁPIDO -->
          <div class="card-resumo">
            <div class="cabecalho-card">
              <h3><i class="fas fa-box-open"></i> Equipamento</h3>
            </div>
            <div class="lista-equipamento-rapido" id="listaEquipamentoRapido">
              <div class="equipamento-item">
                <span class="nome-equipamento">Carregando equipamento...</span>
                <span class="peso-equipamento">-</span>
              </div>
            </div>
          </div>
        </div>
        
      </div>
    </div>
    
    <!-- ABA: ANOTAÇÕES DO MESTRE -->
    <div id="aba-anotacoes" class="conteudo-aba">
      <div class="anotacoes-container">
        <div class="area-anotacoes">
          <h3><i class="fas fa-book"></i> Anotações da Campanha</h3>
          <textarea id="anotacoesGM" class="texto-anotacoes" 
                    placeholder="Anotações privadas do Mestre sobre este personagem..."></textarea>
          <div class="controles-anotacoes">
            <button class="botao-salvar" id="btnSalvarAnotacoes">
              <i class="fas fa-save"></i> Salvar Anotações
            </button>
            <button class="botao-limpar" id="btnLimparAnotacoes">
              <i class="fas fa-trash"></i> Limpar
            </button>
          </div>
        </div>
        
        <div class="historico-campanha">
          <h3><i class="fas fa-history"></i> Histórico da Campanha</h3>
          <div class="lista-historico" id="historicoCampanha">
            <div class="evento-historico">
              <span class="data-evento">Carregando histórico...</span>
              <span class="descricao-evento">Ainda não há eventos registrados</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- MODAL DE CONFIRMAÇÃO -->
  <div id="modal-confirmacao" class="modal-overlay">
    <div class="modal-conteudo pequeno">
      <div class="cabecalho-modal">
        <h3 id="tituloConfirmacao">Confirmar ação</h3>
        <button class="fechar-modal">&times;</button>
      </div>
      <div class="corpo-modal">
        <p id="mensagemConfirmacao">Tem certeza que deseja realizar esta ação?</p>
      </div>
      <div class="rodape-modal">
        <button class="botao-modal perigo" id="btnConfirmarAcao">Confirmar</button>
        <button class="botao-modal secundario" id="btnCancelarAcao">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script src="logica-ficha-gm.js"></script>
</body>
</html>