<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ficha do Personagem - Visão do Mestre</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="estilo-ficha-gm.css">
</head>
<body>
  <!-- LOADING OVERLAY -->
  <div id="loadingOverlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <p>Carregando dados do personagem...</p>
    </div>
  </div>

  <!-- CABEÇALHO DO MESTRE -->
  <header class="cabecalho-mestre">
    <div class="cabecalho-conteudo">
      <!-- LOCALIZAÇÃO -->
      <div class="localizacao">
        <a href="#" id="btnVoltarCampanha" class="link-localizacao">
          <i class="fas fa-arrow-left"></i> Voltar para Campanha
        </a>
        <span class="separador">/</span>
        <span class="atual">Ficha do Personagem</span>
      </div>
      
      <!-- CONTROLES DO MESTRE -->
      <div class="controles-mestre">
        <div class="info-sessao">
          <span class="nome-campanha" id="nomeCampanha">Campanha</span>
          <span class="nome-jogador" id="nomeJogador">Jogador</span>
        </div>
        
        <div class="acoes-mestre">
          <!-- CONTROLE DE VISUALIZAÇÃO -->
          <div class="alternar-visualizacao">
            <button class="botao-visualizacao ativo" data-visao="instantaneo">
              <i class="fas fa-camera"></i> Instantâneo
            </button>
            <button class="botao-visualizacao" data-visao="ao-vivo">
              <i class="fas fa-sync"></i> Ao Vivo
            </button>
            <button class="botao-visualizacao" data-visao="campanha">
              <i class="fas fa-book"></i> Campanha
            </button>
          </div>
          
          <!-- CONTROLES DE GERENCIAMENTO -->
          <div class="gerenciamento-rapido">
            <button class="botao-acao" id="btnCongelar">
              <i class="fas fa-snowflake"></i> Congelar PV
            </button>
            <button class="botao-acao" id="btnSincronizar">
              <i class="fas fa-redo"></i> Sincronizar
            </button>
            <button class="botao-acao perigo" id="btnRemover">
              <i class="fas fa-user-minus"></i> Remover
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- NOME E INFORMAÇÕES PRINCIPAIS -->
  <section class="identificacao-personagem">
    <div class="foto-personagem">
      <div class="container-foto" id="containerFoto">
        <img id="fotoPersonagem" src="" alt="Foto" style="display: none;">
        <div class="placeholder-foto" id="placeholderFoto">
          <i class="fas fa-user-circle"></i>
        </div>
      </div>
    </div>
    
    <div class="dados-principais">
      <h1 id="nomePersonagem">Carregando...</h1>
      <div class="tags-identificacao">
        <span class="tag" id="racaPersonagem">Raça</span>
        <span class="tag" id="classePersonagem">Classe</span>
        <span class="tag" id="nivelPersonagem">Nível 1</span>
        <span class="tag" id="pontosPersonagem">0 pontos</span>
      </div>
      <p class="descricao-personagem" id="descricaoPersonagem">
        Descrição do personagem carregando...
      </p>
    </div>
    
    <div class="status-rapido">
      <div class="card-status">
        <div class="cabecalho-status">
          <i class="fas fa-heartbeat"></i>
          <h4>Pontos de Vida</h4>
          <span class="status-indicator" id="pvStatus"></span>
        </div>
        <div class="conteudo-status">
          <div class="valor-status" id="pvAtualGM">10</div>
          <div class="maximo-status">/ <span id="pvMaximoGM">10</span></div>
        </div>
        <div class="controles-rapidos">
          <button class="btn-controle" data-acao="dano" data-valor="1">-1</button>
          <button class="btn-controle" data-acao="dano" data-valor="5">-5</button>
          <button class="btn-controle cura" data-acao="cura" data-valor="1">+1</button>
          <button class="btn-controle cura" data-acao="cura" data-valor="5">+5</button>
        </div>
        <input type="number" id="inputPvCustom" class="input-custom" placeholder="Valor personalizado" min="1" max="999">
        <button class="btn-controle-full" id="btnAplicarPvCustom">Aplicar</button>
      </div>
      
      <div class="card-status">
        <div class="cabecalho-status">
          <i class="fas fa-bolt"></i>
          <h4>Pontos de Fadiga</h4>
        </div>
        <div class="conteudo-status">
          <div class="valor-status" id="pfAtualGM">10</div>
          <div class="maximo-status">/ <span id="pfMaximoGM">10</span></div>
        </div>
        <div class="controles-rapidos">
          <button class="btn-controle" data-acao="fadiga" data-valor="1">-1</button>
          <button class="btn-controle cura" data-acao="recuperar" data-valor="1">+1</button>
        </div>
      </div>
      
      <div class="card-status">
        <div class="cabecalho-status">
          <i class="fas fa-coins"></i>
          <h4>Dinheiro</h4>
        </div>
        <div class="conteudo-status">
          <div class="valor-status dinheiro" id="dinheiroGM">$0</div>
        </div>
        <div class="controles-rapidos">
          <button class="btn-controle" data-acao="dinheiro" data-valor="10">+$10</button>
          <button class="btn-controle" data-acao="dinheiro" data-valor="50">+$50</button>
        </div>
      </div>
    </div>
  </section>

  <!-- ABA DE NAVEGAÇÃO (TABS) -->
  <nav class="navegacao-fichas">
    <div class="container-tabs">
      <button class="tab ativo" data-tab="resumo">
        <i class="fas fa-eye"></i>
        <span>Visão Geral</span>
      </button>
      <button class="tab" data-tab="atributos">
        <i class="fas fa-dumbbell"></i>
        <span>Atributos</span>
      </button>
      <button class="tab" data-tab="vantagens">
        <i class="fas fa-star"></i>
        <span>Vantagens</span>
      </button>
      <button class="tab" data-tab="desvantagens">
        <i class="fas fa-exclamation-triangle"></i>
        <span>Desvantagens</span>
      </button>
      <button class="tab" data-tab="pericias">
        <i class="fas fa-graduation-cap"></i>
        <span>Perícias</span>
      </button>
      <button class="tab" data-tab="magias">
        <i class="fas fa-hat-wizard"></i>
        <span>Magias</span>
      </button>
      <button class="tab" data-tab="equipamento">
        <i class="fas fa-backpack"></i>
        <span>Equipamento</span>
      </button>
      <button class="tab" data-tab="combate">
        <i class="fas fa-fist-raised"></i>
        <span>Combate</span>
      </button>
      <button class="tab" data-tab="anotacoes">
        <i class="fas fa-edit"></i>
        <span>Anotações</span>
      </button>
    </div>
  </nav>

  <!-- CONTEÚDO DAS ABAS -->
  <main class="conteudo-ficha">
    
    <!-- ABA: VISÃO GERAL (RESUMO) -->
    <div id="aba-resumo" class="conteudo-aba ativo">
      <div class="resumo-container">
        <!-- COLUNA 1: ATRIBUTOS BÁSICOS -->
        <div class="coluna-resumo">
          <div class="card-resumo">
            <div class="cabecalho-card">
              <h3><i class="fas fa-chart-bar"></i> Atributos Principais</h3>
            </div>
            <div class="grade-atributos">
              <div class="item-atributo">
                <span class="rotulo">FOR</span>
                <span class="valor" id="gmST">10</span>
                <span class="modificador" id="gmSTMod">[0]</span>
              </div>
              <div class="item-atributo">
                <span class="rotulo">DES</span>
                <span class="valor" id="gmDX">10</span>
                <span class="modificador" id="gmDXMod">[0]</span>
              </div>
              <div class="item-atributo">
                <span class="rotulo">INT</span>
                <span class="valor" id="gmIQ">10</span>
                <span class="modificador" id="gmIQMod">[0]</span>
              </div>
              <div class="item-atributo">
                <span class="rotulo">SAÚ</span>
                <span class="valor" id="gmHT">10</span>
                <span class="modificador" id="gmHTMod">[0]</span>
              </div>
              <div class="item-atributo">
                <span class="rotulo">VONT</span>
                <span class="valor" id="gmVontade">10</span>
              </div>
              <div class="item-atributo">
                <span class="rotulo">PER</span>
                <span class="valor" id="gmPercepcao">10</span>
              </div>
            </div>
          </div>

          <div class="card-resumo">
            <div class="cabecalho-card">
              <h3><i class="fas fa-running"></i> Movimento</h3>
            </div>
            <div class="info-grid">
              <div class="info-item">
                <span class="rotulo">Deslocamento</span>
                <span class="valor" id="gmDeslocamento">5</span>
              </div>
              <div class="info-item">
                <span class="rotulo">Bônus</span>
                <span class="valor" id="gmBonusMovimento">0</span>
              </div>
              <div class="info-item">
                <span class="rotulo">Carga Atual</span>
                <span class="valor" id="gmCargaAtual">0 lb</span>
              </div>
              <div class="info-item">
                <span class="rotulo">Carga Máx.</span>
                <span class="valor" id="gmCargaMaxima">0 lb</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- COLUNA 2: PERÍCIAS E MAGIAS -->
        <div class="coluna-resumo">
          <div class="card-resumo">
            <div class="cabecalho-card">
              <h3><i class="fas fa-graduation-cap"></i> Perícias Principais</h3>
              <span class="badge" id="totalPericias">0</span>
            </div>
            <div class="lista-pericias-gm" id="listaPericiasGM">
              <div class="pericia-item">
                <span class="nome-pericia">Carregando...</span>
                <span class="nivel-pericia">-</span>
              </div>
            </div>
          </div>

          <div class="card-resumo">
            <div class="cabecalho-card">
              <h3><i class="fas fa-hat-wizard"></i> Magias Conhecidas</h3>
              <span class="badge" id="totalMagias">0</span>
            </div>
            <div class="lista-magias-gm" id="listaMagiasGM">
              <div class="magia-item">
                <span class="nome-magia">Carregando...</span>
                <span class="nivel-magia">-</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- COLUNA 3: EQUIPAMENTO E STATUS -->
        <div class="coluna-resumo">
          <div class="card-resumo">
            <div class="cabecalho-card">
              <h3><i class="fas fa-shield-alt"></i> Status de Combate</h3>
            </div>
            <div class="status-combate-gm">
              <div class="item-status">
                <span class="rotulo">Esquiva:</span>
                <span class="valor" id="gmEsquiva">10</span>
              </div>
              <div class="item-status">
                <span class="rotulo">Bloqueio:</span>
                <span class="valor" id="gmBloqueio">-</span>
              </div>
              <div class="item-status">
                <span class="rotulo">Aparar:</span>
                <span class="valor" id="gmAparar">-</span>
              </div>
              <div class="item-status">
                <span class="rotulo">Dano (Golpe):</span>
                <span class="valor" id="gmDanoGolpe">1d-2</span>
              </div>
              <div class="item-status">
                <span class="rotulo">Dano (Arrem.):</span>
                <span class="valor" id="gmDanoArremesso">1d</span>
              </div>
            </div>
          </div>

          <div class="card-resumo">
            <div class="cabecalho-card">
              <h3><i class="fas fa-box-open"></i> Equipamento Rápido</h3>
            </div>
            <div class="lista-equipamento-rapido" id="listaEquipamentoRapido">
              <div class="equipamento-item">
                <span class="nome-equipamento">Carregando...</span>
                <span class="peso-equipamento">-</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ABA: ATRIBUTOS -->
    <div id="aba-atributos" class="conteudo-aba">
      <div class="atributos-container">
        <div class="card-atributos">
          <h3><i class="fas fa-chart-line"></i> Atributos Detalhados</h3>
          <div class="tabela-atributos">
            <div class="linha-tabela cabecalho-tabela">
              <div class="coluna">Atributo</div>
              <div class="coluna">Valor</div>
              <div class="coluna">Custo</div>
              <div class="coluna">Modificador</div>
            </div>
            <div class="linha-tabela">
              <div class="coluna">Força (ST)</div>
              <div class="coluna" id="detalheST">10</div>
              <div class="coluna">0</div>
              <div class="coluna" id="detalheSTMod">[0]</div>
            </div>
            <div class="linha-tabela">
              <div class="coluna">Destreza (DX)</div>
              <div class="coluna" id="detalheDX">10</div>
              <div class="coluna">0</div>
              <div class="coluna" id="detalheDXMod">[0]</div>
            </div>
            <div class="linha-tabela">
              <div class="coluna">Inteligência (IQ)</div>
              <div class="coluna" id="detalheIQ">10</div>
              <div class="coluna">0</div>
              <div class="coluna" id="detalheIQMod">[0]</div>
            </div>
            <div class="linha-tabela">
              <div class="coluna">Saúde (HT)</div>
              <div class="coluna" id="detalheHT">10</div>
              <div class="coluna">0</div>
              <div class="coluna" id="detalheHTMod">[0]</div>
            </div>
          </div>
        </div>

        <div class="card-atributos">
          <h3><i class="fas fa-calculator"></i> Pontuação GURPS</h3>
          <div class="pontuacao-grid">
            <div class="pontuacao-item">
              <span class="rotulo">Pontos Totais:</span>
              <span class="valor" id="pontosTotais">0</span>
            </div>
            <div class="pontuacao-item">
              <span class="rotulo">Pontos Gastos:</span>
              <span class="valor" id="pontosGastos">0</span>
            </div>
            <div class="pontuacao-item">
              <span class="rotulo">Disponíveis:</span>
              <span class="valor" id="pontosDisponiveis">0</span>
            </div>
            <div class="pontuacao-item">
              <span class="rotulo">Limite Desvantagens:</span>
              <span class="valor" id="limiteDesvantagens">-40</span>
            </div>
            <div class="pontuacao-item">
              <span class="rotulo">Desvantagens Atuais:</span>
              <span class="valor" id="desvantagensAtuais">0</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ABA: VANTAGENS -->
    <div id="aba-vantagens" class="conteudo-aba">
      <div class="vantagens-container">
        <div class="card-vantagens">
          <div class="cabecalho-card">
            <h3><i class="fas fa-star"></i> Vantagens</h3>
            <span class="badge" id="totalVantagensGM">0</span>
          </div>
          <div class="lista-vantagens-gm" id="listaVantagensGM">
            <div class="vantagem-item">
              <span class="nome-vantagem">Carregando...</span>
              <span class="custo-vantagem">-</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ABA: DESVANTAGENS -->
    <div id="aba-desvantagens" class="conteudo-aba">
      <div class="desvantagens-container">
        <div class="card-desvantagens">
          <div class="cabecalho-card">
            <h3><i class="fas fa-exclamation-triangle"></i> Desvantagens</h3>
            <span class="badge" id="totalDesvantagensGM">0</span>
          </div>
          <div class="lista-desvantagens-gm" id="listaDesvantagensGM">
            <div class="desvantagem-item">
              <span class="nome-desvantagem">Carregando...</span>
              <span class="custo-desvantagem">-</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ABA: PERÍCIAS -->
    <div id="aba-pericias" class="conteudo-aba">
      <div class="pericias-container">
        <div class="card-pericias">
          <div class="cabecalho-card">
            <h3><i class="fas fa-graduation-cap"></i> Perícias</h3>
            <div class="filtros-pericias">
              <input type="text" id="filtroPericias" placeholder="Filtrar perícias..." class="filtro-input">
              <select id="filtroAtributo" class="filtro-select">
                <option value="">Todos atributos</option>
                <option value="ST">FOR</option>
                <option value="DX">DES</option>
                <option value="IQ">INT</option>
                <option value="HT">SAÚ</option>
              </select>
            </div>
          </div>
          <div class="tabela-pericias-gm" id="tabelaPericiasGM">
            <!-- Tabela será populada via JS -->
          </div>
        </div>
      </div>
    </div>
    
    <!-- ABA: MAGIAS -->
    <div id="aba-magias" class="conteudo-aba">
      <div class="magias-container">
        <div class="card-magias">
          <div class="cabecalho-card">
            <h3><i class="fas fa-hat-wizard"></i> Magias</h3>
            <span class="badge" id="totalMagiasDetalhado">0</span>
          </div>
          <div class="lista-magias-detalhado" id="listaMagiasDetalhado">
            <!-- Magias serão populadas via JS -->
          </div>
        </div>
      </div>
    </div>
    
    <!-- ABA: EQUIPAMENTO -->
    <div id="aba-equipamento" class="conteudo-aba">
      <div class="equipamento-container">
        <div class="card-equipamento">
          <div class="cabecalho-card">
            <h3><i class="fas fa-backpack"></i> Inventário Completo</h3>
            <div class="estatisticas-equipamento">
              <span>Peso: <span id="pesoAtualGM">0</span>/<span id="pesoMaximoGM">0</span> lb</span>
            </div>
          </div>
          <div class="tabela-equipamento-gm" id="tabelaEquipamentoGM">
            <!-- Tabela será populada via JS -->
          </div>
        </div>
      </div>
    </div>
    
    <!-- ABA: COMBATE -->
    <div id="aba-combate" class="conteudo-aba">
      <div class="combate-container">
        <!-- DEFESAS -->
        <div class="card-combate">
          <h3><i class="fas fa-shield-alt"></i> Defesas</h3>
          <div class="defesas-grid">
            <div class="defesa-item">
              <span class="rotulo">Esquiva</span>
              <span class="valor" id="combateEsquiva">10</span>
            </div>
            <div class="defesa-item">
              <span class="rotulo">Esquiva Mod.</span>
              <span class="valor" id="combateEsquivaMod">0</span>
            </div>
            <div class="defesa-item">
              <span class="rotulo">Bloqueio</span>
              <span class="valor" id="combateBloqueio">-</span>
            </div>
            <div class="defesa-item">
              <span class="rotulo">Bloqueio Mod.</span>
              <span class="valor" id="combateBloqueioMod">0</span>
            </div>
            <div class="defesa-item">
              <span class="rotulo">Aparar</span>
              <span class="valor" id="combateAparar">-</span>
            </div>
            <div class="defesa-item">
              <span class="rotulo">Aparar Mod.</span>
              <span class="valor" id="combateApararMod">0</span>
            </div>
          </div>
        </div>

        <!-- DANO -->
        <div class="card-combate">
          <h3><i class="fas fa-crosshairs"></i> Dano Básico</h3>
          <div class="dano-grid">
            <div class="dano-item">
              <span class="rotulo">Golpe (Thrust)</span>
              <span class="valor" id="combateThrust">1d-2</span>
            </div>
            <div class="dano-item">
              <span class="rotulo">Arremesso (Swing)</span>
              <span class="valor" id="combateSwing">1d</span>
            </div>
          </div>
        </div>

        <!-- ARMADURA -->
        <div class="card-combate">
          <h3><i class="fas fa-shield"></i> Proteção (DR)</h3>
          <div class="armadura-grid">
            <div class="armadura-item">
              <span class="rotulo">Cabeça</span>
              <span class="valor" id="drCabeca">0</span>
            </div>
            <div class="armadura-item">
              <span class="rotulo">Tronco</span>
              <span class="valor" id="drTronco">0</span>
            </div>
            <div class="armadura-item">
              <span class="rotulo">Braços</span>
              <span class="valor" id="drBracos">0</span>
            </div>
            <div class="armadura-item">
              <span class="rotulo">Pernas</span>
              <span class="valor" id="drPernas">0</span>
            </div>
            <div class="armadura-item">
              <span class="rotulo">Total</span>
              <span class="valor" id="drTotal">0</span>
            </div>
          </div>
        </div>

        <!-- ESCUDO -->
        <div class="card-combate">
          <h3><i class="fas fa-shield-virus"></i> Escudo</h3>
          <div class="escudo-info" id="infoEscudo">
            <p>Nenhum escudo equipado</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ABA: ANOTAÇÕES DO MESTRE -->
    <div id="aba-anotacoes" class="conteudo-aba">
      <div class="anotacoes-container">
        <div class="area-anotacoes">
          <h3><i class="fas fa-book"></i> Anotações da Campanha</h3>
          <textarea id="anotacoesGM" class="texto-anotacoes" 
                    placeholder="Anotações privadas do Mestre sobre este personagem..."></textarea>
          <div class="controles-anotacoes">
            <button class="botao-salvar" id="btnSalvarAnotacoes">
              <i class="fas fa-save"></i> Salvar Anotações
            </button>
            <button class="botao-limpar" id="btnLimparAnotacoes">
              <i class="fas fa-trash"></i> Limpar
            </button>
          </div>
        </div>
        
        <div class="historico-campanha">
          <h3><i class="fas fa-history"></i> Histórico da Campanha</h3>
          <div class="lista-historico" id="historicoCampanha">
            <div class="evento-historico">
              <span class="data-evento">Carregando histórico...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- MODAL PARA CONFIGURAÇÕES -->
  <div id="modal-config" class="modal-overlay">
    <div class="modal-conteudo">
      <div class="cabecalho-modal">
        <h3><i class="fas fa-cog"></i> Configurações da Visualização</h3>
        <button class="fechar-modal">&times;</button>
      </div>
      <div class="corpo-modal">
        <div class="opcao-config">
          <input type="checkbox" id="autoAtualizar" checked>
          <label for="autoAtualizar">Atualizar dados automaticamente</label>
        </div>
        <div class="opcao-config">
          <label for="intervaloAtualizacao">Intervalo de atualização:</label>
          <select id="intervaloAtualizacao">
            <option value="30000">30 segundos</option>
            <option value="60000">1 minuto</option>
            <option value="300000">5 minutos</option>
            <option value="0">Manual</option>
          </select>
        </div>
      </div>
      <div class="rodape-modal">
        <button class="botao-modal" id="btnSalvarConfig">Salvar</button>
        <button class="botao-modal secundario" id="btnFecharConfig">Fechar</button>
      </div>
    </div>
  </div>

  <!-- MODAL DE CONFIRMAÇÃO -->
  <div id="modal-confirmacao" class="modal-overlay">
    <div class="modal-conteudo pequeno">
      <div class="cabecalho-modal">
        <h3 id="tituloConfirmacao">Confirmar ação</h3>
        <button class="fechar-modal">&times;</button>
      </div>
      <div class="corpo-modal">
        <p id="mensagemConfirmacao">Tem certeza que deseja realizar esta ação?</p>
      </div>
      <div class="rodape-modal">
        <button class="botao-modal perigo" id="btnConfirmarAcao">Confirmar</button>
        <button class="botao-modal secundario" id="btnCancelarAcao">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script src="logica-ficha-gm.js"></script>
</body>
</html>