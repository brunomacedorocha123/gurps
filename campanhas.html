<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campanhas - RPG System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #0f172a;
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* HEADER */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 2px solid #f59e0b;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .back-btn {
            background: none;
            border: 2px solid #f59e0b;
            color: #f59e0b;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-btn:hover {
            background: #f59e0b;
            color: #0f172a;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: #f59e0b;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0f172a;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .logout-btn {
            background: #dc2626;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logout-btn:hover {
            background: #b91c1c;
        }

        /* FILTROS */
        .filters-container {
            background: #1e293b;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid #334155;
        }

        .filters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .filter-label {
            display: block;
            color: #e2e8f0;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        .filter-select, .filter-input {
            width: 100%;
            padding: 10px 12px;
            background: #334155;
            border: 1px solid #475569;
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }

        /* CAMPANHAS GRID */
        .campaigns-container {
            background: #1e293b;
            border-radius: 15px;
            padding: 30px;
            border: 1px solid #334155;
        }

        .campaigns-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .campaigns-header h2 {
            color: #fbbf24;
            font-size: 24px;
        }

        .create-campaign-btn {
            background: linear-gradient(45deg, #f59e0b, #d97706);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .create-campaign-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
        }

        .campaigns-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        /* CAMPANHA CARD */
        .campaign-card {
            background: #334155;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #475569;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .campaign-card:hover {
            transform: translateY(-5px);
            border-color: #f59e0b;
            box-shadow: 0 10px 20px rgba(245, 158, 11, 0.1);
        }

        .campaign-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .campaign-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #f59e0b, #d97706);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #0f172a;
        }

        .campaign-title {
            flex: 1;
        }

        .campaign-name {
            color: #fbbf24;
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .campaign-id {
            color: #94a3b8;
            font-size: 12px;
            font-family: monospace;
        }

        .campaign-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-active {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .status-paused {
            background: rgba(234, 179, 8, 0.2);
            color: #eab308;
            border: 1px solid rgba(234, 179, 8, 0.3);
        }

        .status-finished {
            background: rgba(148, 163, 184, 0.2);
            color: #94a3b8;
            border: 1px solid rgba(148, 163, 184, 0.3);
        }

        .campaign-info {
            margin: 15px 0;
        }

        .campaign-description {
            color: #cbd5e1;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .campaign-meta {
            display: flex;
            justify-content: space-between;
            color: #94a3b8;
            font-size: 12px;
        }

        .campaign-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #475569;
        }

        .campaign-players {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #94a3b8;
            font-size: 12px;
        }

        .campaign-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background: #f59e0b;
            color: white;
        }

        .btn-secondary {
            background: #475569;
            color: white;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        /* NO CAMPAIGNS STATE */
        .no-campaigns {
            text-align: center;
            padding: 60px 20px;
        }

        .no-campaigns-icon {
            font-size: 60px;
            color: #475569;
            margin-bottom: 20px;
        }

        .no-campaigns-title {
            color: #94a3b8;
            font-size: 24px;
            margin-bottom: 15px;
        }

        .no-campaigns-text {
            color: #64748b;
            font-size: 16px;
            line-height: 1.5;
            max-width: 500px;
            margin: 0 auto 30px;
        }

        /* LOADING */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .loading i {
            font-size: 40px;
            color: #f59e0b;
            margin-bottom: 15px;
            display: block;
        }

        .loading p {
            color: #94a3b8;
        }

        /* MOBILE */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .app-header {
                flex-direction: column;
                gap: 15px;
                padding: 15px 0;
                margin-bottom: 20px;
            }

            .header-left {
                width: 100%;
                justify-content: space-between;
            }

            .header-right {
                width: 100%;
                justify-content: space-between;
            }

            .back-btn {
                padding: 8px 12px;
                font-size: 14px;
            }

            .logout-btn {
                padding: 8px 12px;
                font-size: 14px;
            }

            .filters-container {
                padding: 15px;
                margin-bottom: 20px;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .campaigns-container {
                padding: 20px;
            }

            .campaigns-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
                margin-bottom: 20px;
            }

            .campaigns-header h2 {
                font-size: 20px;
            }

            .create-campaign-btn {
                width: 100%;
                justify-content: center;
            }

            .campaigns-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .campaign-card {
                padding: 15px;
            }

            .campaign-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .campaign-avatar {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }

            .campaign-footer {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .campaign-actions {
                width: 100%;
            }

            .campaign-actions .btn {
                flex: 1;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <header class="app-header">
            <div class="header-left">
                <button class="back-btn" id="backBtn">
                    <i class="fas fa-arrow-left"></i> Voltar
                </button>
                <h1 style="color: #fbbf24;">Campanhas</h1>
            </div>
            <div class="header-right">
                <div class="user-avatar" id="userAvatar">U</div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </button>
            </div>
        </header>

        <!-- FILTROS -->
        <div class="filters-container">
            <div class="filters-header">
                <h3 style="color: #fbbf24;">Filtrar Campanhas</h3>
                <button class="btn btn-secondary" id="clearFilters">
                    <i class="fas fa-times"></i> Limpar Filtros
                </button>
            </div>
            <div class="filters-grid">
                <div class="filter-group">
                    <label class="filter-label">Status</label>
                    <select class="filter-select" id="filterStatus">
                        <option value="">Todos os Status</option>
                        <option value="active">Ativas</option>
                        <option value="paused">Pausadas</option>
                        <option value="finished">Finalizadas</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Guilda</label>
                    <select class="filter-select" id="filterGuild">
                        <option value="">Todas as Guildas</option>
                        <!-- Guildas serão preenchidas via JS -->
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Cenário</label>
                    <input type="text" class="filter-input" id="filterScenario" placeholder="Ex: Fantasia, Cyberpunk...">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Buscar por Nome</label>
                    <input type="text" class="filter-input" id="filterSearch" placeholder="Nome da campanha...">
                </div>
            </div>
        </div>

        <!-- CAMPANHAS -->
        <div class="campaigns-container">
            <div class="campaigns-header">
                <h2>Minhas Campanhas</h2>
                <button class="create-campaign-btn" id="createCampaignBtn">
                    <i class="fas fa-plus"></i> Nova Campanha
                </button>
            </div>

            <div id="campaignsContent">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Carregando campanhas...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
// ==============================================
// CONFIGURAÇÃO ÚNICA E ISOLADA
// ==============================================
const CAMPANHAS_SUPABASE_URL = 'https://pujufdfhaxveuytkneqw.supabase.co';
const CAMPANHAS_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB1anVmZGZoYXh2ZXV5dGtuZXF3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzNTkyODksImV4cCI6MjA3OTkzNTI4OX0.mzOwsmf8qIQ4HZqnXLEmq4D7M6fz4VH1YWpWP-BsFvc';

// Criar cliente único para esta página
const campanhasSupabase = window.supabase.createClient(CAMPANHAS_SUPABASE_URL, CAMPANHAS_ANON_KEY);

// Estado isolado para esta página
let campanhasState = {
    currentUser: null,
    userGuilds: [],
    campaigns: [],
    filteredCampaigns: []
};

// ==============================================
// FUNÇÕES PRINCIPAIS
// ==============================================
async function initCampanhas() {
    console.log('Iniciando página de campanhas...');
    await checkCampanhasAuth();
    await loadCampanhasUserData();
    await loadUserGuildsForCampanhas();
    await loadCampaigns();
    setupCampanhasEventListeners();
}

async function checkCampanhasAuth() {
    const { data: { session } } = await campanhasSupabase.auth.getSession();
    if (!session) {
        window.location.href = 'login.html';
        return null;
    }
    campanhasState.currentUser = session.user;
    return session;
}

async function loadCampanhasUserData() {
    if (!campanhasState.currentUser) return;
    
    const { data: profile } = await campanhasSupabase
        .from('profiles')
        .select('*')
        .eq('id', campanhasState.currentUser.id)
        .single();

    if (profile) {
        const initials = profile.username?.charAt(0).toUpperCase() || 'U';
        document.getElementById('userAvatar').innerHTML = initials;
    }
}

async function loadUserGuildsForCampanhas() {
    console.log('Carregando guildas para campanhas...');
    
    if (!campanhasState.currentUser) {
        console.error('Usuário não autenticado');
        return;
    }
    
    const { data: memberships, error } = await campanhasSupabase
        .from('guild_members')
        .select(`
            *,
            profiles!guild_members_user_id_fkey (username),
            guilds!guild_members_guild_id_fkey (*)
        `)
        .eq('user_id', campanhasState.currentUser.id)
        .eq('status', 'accepted');
    
    if (error) {
        console.error('Erro ao carregar guildas:', error);
        return;
    }
    
    if (memberships && memberships.length > 0) {
        campanhasState.userGuilds = memberships.map(membership => ({
            ...membership.guilds,
            member_role: membership.role,
            member_username: membership.profiles?.username
        }));
        
        // Preencher select de filtro de guildas
        const guildFilter = document.getElementById('filterGuild');
        if (guildFilter) {
            campanhasState.userGuilds.forEach(guild => {
                const option = document.createElement('option');
                option.value = guild.id;
                option.textContent = guild.name;
                guildFilter.appendChild(option);
            });
        }
    }
}

async function loadCampaigns() {
    console.log('Carregando campanhas...');
    
    if (!campanhasState.currentUser) return;
    
    try {
        // Buscar campanhas onde o usuário é GM
        const { data: gmCampaigns, error: gmError } = await campanhasSupabase
            .from('campaigns')
            .select('*, guilds(*)')
            .eq('gm_id', campanhasState.currentUser.id)
            .order('created_at', { ascending: false });

        // Buscar campanhas onde o usuário é participante
        const { data: participantCampaigns, error: participantError } = await campanhasSupabase
            .from('campaign_participants')
            .select('campaign_id')
            .eq('user_id', campanhasState.currentUser.id);

        let participantCampaignsData = [];
        
        if (participantCampaigns && participantCampaigns.length > 0) {
            const campaignIds = participantCampaigns.map(p => p.campaign_id);
            
            const { data: campaignsData, error: campaignsError } = await campanhasSupabase
                .from('campaigns')
                .select('*, guilds(*)')
                .in('campaign_id', campaignIds)
                .neq('gm_id', campanhasState.currentUser.id) // Já pegamos as do GM acima
                .order('created_at', { ascending: false });
            
            if (!campaignsError && campaignsData) {
                participantCampaignsData = campaignsData;
            }
        }

        // Combinar todas as campanhas
        const allCampaigns = [...(gmCampaigns || []), ...participantCampaignsData];
        
        // Remover duplicatas (caso o usuário esteja em ambas as queries)
        const uniqueCampaigns = [];
        const seenIds = new Set();
        
        allCampaigns.forEach(campaign => {
            if (!seenIds.has(campaign.id)) {
                seenIds.add(campaign.id);
                uniqueCampaigns.push(campaign);
            }
        });

        campanhasState.campaigns = uniqueCampaigns;
        campanhasState.filteredCampaigns = [...uniqueCampaigns];
        
        renderCampaigns();
        
    } catch (error) {
        console.error('Erro ao carregar campanhas:', error);
        showCampaignsError();
    }
}

function renderCampaigns() {
    const campaignsContent = document.getElementById('campaignsContent');
    if (!campaignsContent) return;
    
    if (campanhasState.filteredCampaigns.length === 0) {
        campaignsContent.innerHTML = `
            <div class="no-campaigns">
                <div class="no-campaigns-icon">
                    <i class="fas fa-map"></i>
                </div>
                <h3 class="no-campaigns-title">Nenhuma campanha encontrada</h3>
                <p class="no-campaigns-text">
                    Você ainda não criou ou participa de nenhuma campanha.<br>
                    Crie sua primeira campanha ou aguarde um convite.
                </p>
                <button class="create-campaign-btn" id="createFirstCampaignBtn">
                    <i class="fas fa-plus"></i> Criar Primeira Campanha
                </button>
            </div>
        `;
        
        // Adicionar event listener ao botão
        setTimeout(() => {
            const createFirstBtn = document.getElementById('createFirstCampaignBtn');
            if (createFirstBtn) {
                createFirstBtn.addEventListener('click', () => {
                    window.location.href = 'criar-campanha.html';
                });
            }
        }, 100);
        
        return;
    }
    
    campaignsContent.innerHTML = `
        <div class="campaigns-grid" id="campaignsGrid"></div>
    `;
    
    const campaignsGrid = document.getElementById('campaignsGrid');
    if (!campaignsGrid) return;
    
    campanhasState.filteredCampaigns.forEach(campaign => {
        const isGM = campaign.gm_id === campanhasState.currentUser.id;
        const guildName = campaign.guilds?.name || 'Guilda desconhecida';
        
        const campaignCard = document.createElement('div');
        campaignCard.className = 'campaign-card';
        campaignCard.onclick = () => openCampaign(campaign.campaign_id);
        
        campaignCard.innerHTML = `
            <div class="campaign-header">
                <div class="campaign-avatar">
                    <i class="fas fa-map"></i>
                </div>
                <div class="campaign-title">
                    <div class="campaign-name">${campanhasEscapeHtml(campaign.name)}</div>
                    <div class="campaign-id">ID: ${campanhasEscapeHtml(campaign.campaign_id)}</div>
                </div>
                <div class="campaign-status ${'status-' + campaign.status}">
                    <i class="fas fa-circle"></i>
                    ${campaign.status === 'active' ? 'Ativa' : 
                      campaign.status === 'paused' ? 'Pausada' : 'Finalizada'}
                </div>
            </div>
            
            <div class="campaign-info">
                <div class="campaign-description">
                    ${campanhasEscapeHtml(campaign.description || 'Sem descrição')}
                </div>
                <div class="campaign-meta">
                    <span><i class="fas fa-users"></i> ${guildName}</span>
                    <span><i class="fas fa-calendar"></i> ${campanhasFormatDate(campaign.created_at)}</span>
                </div>
            </div>
            
            <div class="campaign-footer">
                <div class="campaign-players">
                    <i class="fas fa-crown"></i>
                    <span>${isGM ? 'Você (GM)' : 'Participante'}</span>
                </div>
                <div class="campaign-actions" onclick="event.stopPropagation()">
                    ${isGM ? `
                        <button class="btn btn-primary" onclick="editCampaign('${campaign.campaign_id}')">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-danger" onclick="deleteCampaign('${campaign.campaign_id}', '${campanhasEscapeHtml(campaign.name)}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    ` : `
                        <button class="btn btn-secondary" onclick="leaveCampaign('${campaign.campaign_id}', '${campanhasEscapeHtml(campaign.name)}')">
                            <i class="fas fa-sign-out-alt"></i> Sair
                        </button>
                    `}
                </div>
            </div>
        `;
        
        campaignsGrid.appendChild(campaignCard);
    });
}

function applyFilters() {
    const statusFilter = document.getElementById('filterStatus')?.value;
    const guildFilter = document.getElementById('filterGuild')?.value;
    const scenarioFilter = document.getElementById('filterScenario')?.value.toLowerCase();
    const searchFilter = document.getElementById('filterSearch')?.value.toLowerCase();
    
    campanhasState.filteredCampaigns = campanhasState.campaigns.filter(campaign => {
        // Filtro de status
        if (statusFilter && campaign.status !== statusFilter) return false;
        
        // Filtro de guilda
        if (guildFilter && campaign.guild_id !== guildFilter) return false;
        
        // Filtro de cenário
        if (scenarioFilter && campaign.scenario) {
            if (!campaign.scenario.toLowerCase().includes(scenarioFilter)) return false;
        }
        
        // Filtro de busca
        if (searchFilter) {
            const nameMatch = campaign.name.toLowerCase().includes(searchFilter);
            const descMatch = campaign.description?.toLowerCase().includes(searchFilter);
            const idMatch = campaign.campaign_id.toLowerCase().includes(searchFilter);
            
            if (!nameMatch && !descMatch && !idMatch) return false;
        }
        
        return true;
    });
    
    renderCampaigns();
}

function clearFilters() {
    document.getElementById('filterStatus').value = '';
    document.getElementById('filterGuild').value = '';
    document.getElementById('filterScenario').value = '';
    document.getElementById('filterSearch').value = '';
    
    campanhasState.filteredCampaigns = [...campanhasState.campaigns];
    renderCampaigns();
}

// ==============================================
// AÇÕES DAS CAMPANHAS
// ==============================================
function openCampaign(campaignId) {
    window.location.href = `campanha-detalhes.html?id=${campaignId}`;
}

function editCampaign(campaignId) {
    window.location.href = `criar-campanha.html?edit=${campaignId}`;
}

async function deleteCampaign(campaignId, campaignName) {
    if (!confirm(`Tem certeza que deseja excluir a campanha "${campaignName}"?\n\nEsta ação é irreversível!`)) {
        return;
    }
    
    try {
        const { error } = await campanhasSupabase
            .from('campaigns')
            .delete()
            .eq('campaign_id', campaignId)
            .eq('gm_id', campanhasState.currentUser.id);
        
        if (error) {
            console.error('Erro ao excluir campanha:', error);
            alert('Erro ao excluir campanha: ' + error.message);
            return;
        }
        
        alert('Campanha excluída com sucesso!');
        await loadCampaigns();
        
    } catch (error) {
        console.error('Erro ao excluir campanha:', error);
        alert('Erro: ' + error.message);
    }
}

async function leaveCampaign(campaignId, campaignName) {
    if (!confirm(`Tem certeza que deseja sair da campanha "${campaignName}"?`)) {
        return;
    }
    
    try {
        const { error } = await campanhasSupabase
            .from('campaign_participants')
            .delete()
            .eq('campaign_id', campaignId)
            .eq('user_id', campanhasState.currentUser.id);
        
        if (error) {
            console.error('Erro ao sair da campanha:', error);
            alert('Erro ao sair da campanha: ' + error.message);
            return;
        }
        
        alert('Você saiu da campanha!');
        await loadCampaigns();
        
    } catch (error) {
        console.error('Erro ao sair da campanha:', error);
        alert('Erro: ' + error.message);
    }
}

// ==============================================
// EVENT LISTENERS
// ==============================================
function setupCampanhasEventListeners() {
    // Botão voltar
    const backBtn = document.getElementById('backBtn');
    if (backBtn) {
        backBtn.addEventListener('click', () => {
            window.location.href = 'home.html';
        });
    }
    
    // Botão logout
    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', async () => {
            try {
                await campanhasSupabase.auth.signOut();
                window.location.href = 'login.html';
            } catch (error) {
                console.error('Erro ao sair:', error);
                alert('Erro ao sair. Tente novamente.');
            }
        });
    }
    
    // Botão criar campanha
    const createCampaignBtn = document.getElementById('createCampaignBtn');
    if (createCampaignBtn) {
        createCampaignBtn.addEventListener('click', () => {
            window.location.href = 'criar-campanha.html';
        });
    }
    
    // Botão limpar filtros
    const clearFiltersBtn = document.getElementById('clearFilters');
    if (clearFiltersBtn) {
        clearFiltersBtn.addEventListener('click', clearFilters);
    }
    
    // Filtros
    const filterInputs = document.querySelectorAll('#filterStatus, #filterGuild, #filterScenario, #filterSearch');
    filterInputs.forEach(input => {
        input.addEventListener('input', applyFilters);
        input.addEventListener('change', applyFilters);
    });
}

// ==============================================
// UTILITÁRIOS (ISOLADOS)
// ==============================================
function campanhasEscapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function campanhasFormatDate(dateString) {
    if (!dateString) return 'Data desconhecida';
    try {
        const date = new Date(dateString);
        return date.toLocaleDateString('pt-BR');
    } catch (error) {
        return 'Data inválida';
    }
}

function showCampaignsError() {
    const campaignsContent = document.getElementById('campaignsContent');
    if (campaignsContent) {
        campaignsContent.innerHTML = `
            <div class="no-campaigns">
                <div class="no-campaigns-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3 class="no-campaigns-title">Erro ao carregar campanhas</h3>
                <p class="no-campaigns-text">
                    Ocorreu um erro ao carregar suas campanhas.<br>
                    Tente novamente mais tarde.
                </p>
                <button class="create-campaign-btn" onclick="location.reload()">
                    <i class="fas fa-redo"></i> Tentar Novamente
                </button>
            </div>
        `;
    }
}

// ==============================================
// INICIALIZAÇÃO
// ==============================================
document.addEventListener('DOMContentLoaded', initCampanhas);
    </script>
</body>
</html>